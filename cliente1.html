<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cliente 1 - Web Principal (CRUD + Estado)</title>
</head>
<body>

<h2>LOGIN</h2>
<input id="user" placeholder="usuario" value="admin"><br>
<input id="pass" placeholder="contraseña" value="admin123"><br>
<button onclick="login()">Login</button>

<p id="loginStatus"></p>

<hr>

<h2>Activos (CRUD via S1)</h2>

<button onclick="getActivos()">GET Activos</button>

<h3>Crear Activo</h3>
<input id="name" placeholder="Nombre"><br>
<input id="ip" placeholder="IP"><br>
<input id="type" placeholder="Tipo (server/router/firewall)"><br>
<button onclick="crearActivo()">Crear</button>

<pre id="output"></pre>

<hr>

<h2>Consultar Estado (via S1 → S2)</h2>
<input id="estadoId" placeholder="ID del activo"><br>
<button onclick="consultarEstado()">Consultar</button>

<pre id="estadoOut"></pre>

<hr>

<h2>Comparar con Baseline (via S1 → S2 → S3)</h2>
<input id="compId" placeholder="ID del activo"><br>
<button onclick="comparar()">Comparar</button>

<pre id="comparacionOut"></pre>

<script>
let TOKEN = null;

async function login() {
    try {
        const res = await fetch("http://localhost:4001/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user: document.getElementById("user").value,
                pass: document.getElementById("pass").value
            })
        });

        const data = await res.json();
        console.log("LOGIN RESPONSE:", data);
        if (data.token) {
            TOKEN = data.token;
            document.getElementById("loginStatus").innerText = "Login OK";
        } else {
            document.getElementById("loginStatus").innerText = "Error login: " + JSON.stringify(data);
        }
    } catch (err) {
        console.error("ERROR LOGIN:", err);
        alert("Error en login: " + err);
    }
}

async function getActivos() {
    try {
        const res = await fetch("http://localhost:4001/activos", {
            headers: { "Authorization": TOKEN }
        });
        const data = await res.json();
        console.log("GET ACTIVOS:", data);
        document.getElementById("output").innerText = JSON.stringify(data, null, 2);
    } catch (err) {
        console.error("ERROR GET ACTIVOS:", err);
        alert("Error: " + err);
    }
}

async function crearActivo() {
    try {
        const res = await fetch("http://localhost:4001/activos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": TOKEN
            },
            body: JSON.stringify({
                name: document.getElementById("name").value,
                ip: document.getElementById("ip").value,
                type: document.getElementById("type").value
            })
        });

        const data = await res.json();
        console.log("CREAR ACTIVOS:", data);
        document.getElementById("output").innerText = JSON.stringify(data, null, 2);
    } catch (err) {
        console.error("ERROR CREAR:", err);
        alert("Error: " + err);
    }
}

async function consultarEstado() {
    try {
        const id = document.getElementById("estadoId").value;
        const res = await fetch(`http://localhost:4001/activos/${id}/estado`, {
            headers: { Authorization: TOKEN }
        });
        const data = await res.json();
        console.log("ESTADO:", data);
        document.getElementById("estadoOut").innerText = JSON.stringify(data, null, 2);
    } catch (err) {
        console.error("ERROR ESTADO:", err);
        alert("Error: " + err);
    }
}

async function comparar() {
    try {
        const id = document.getElementById("compId").value;
        const res = await fetch(`http://localhost:4001/comparar/${id}`, {
            headers: { Authorization: TOKEN }
        });
        const data = await res.json();
        console.log("COMPARACION:", data);
        document.getElementById("comparacionOut").innerText = JSON.stringify(data, null, 2);
    } catch (err) {
        console.error("ERROR COMPARAR:", err);
        alert("Error: " + err);
    }
}
</script>

</body>
</html>
